<html>
<head>
  <meta charset="utf-8">
  <title>Demo</title>

  <style type="text/css" media="screen">
    #editor {
        width: 700px;
        height: 400px;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
    }
  </style>

  <!-- js -->
  <script src="js/jquery-2.0.3.min.js"></script>
  <script src="js/three.min.js"></script>
  <script src="js/sylvester.src.js"></script>
  <script src="js/glUtils.js"></script>
  <script src="js/seedrandom.js"></script>
  <script src="js/OrbitControls.js"></script>
  <script src="js/ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
  <script src="pcg/main.js"></script>
  <script src="pcg/parser.js"></script>
  <script src="pcg/compiler.js"></script>
  <script src="pcg/default-env.js"></script>
  <script src="pcg/Scene.js"></script>
  <script src="pcg/three-additions.js"></script>

</head>
<body>

<div id="editor">def radius(y, t, p)
  return abs(y-.5)^p

def engine(size)
  loop i 1 size
    transform 0 0 0 1 sqrt(i) 1
      lathe 20 20
        return y*radius(y, t, (i*i)/10) + y*(1-y)

def engines()
  transform 0 0 0-1
    transform -.5 0 0 .5 .5 .5 pi/2 0 0
      engine(5)
    transform .5 0 0 .5 .5 .5 pi/2 0 0
      engine(5)

def hull()
  transform 0 0-.2 1 1 2 1 pi/2 0 0
    lathe 50 50
      return (y^.1)/(1+abs(pi - t))

def fins(count)
  loop i 0 count-1
    transform 0 0 i*.3-.5 .6/(i+1)^.2 .1 1/(i+1)^.3 pi/2 0 0
      lathe 20 8
        return 1

engines()
hull()
fins(12)
</div>

<input id="submitbutton" type="button" value="Run" />
<div id="container" style="width:700px; height:500px; background-color: #eee;"></div>
<div id="console" style="width:700px; height:400px; border: solid 1px;"></div>

<script>

var editor = ace.edit("editor");
editor.setTheme("ace/theme/monokai");
editor.getSession().setMode("ace/mode/python");
editor.session.setUseWorker(false)
editor.getSession().setTabSize(2);

// Utility function to log messages
var log_console = function(msg) {
    $('#console').append('<p>' + msg + '</p>');
};

var SCENE; // my custom scene object

// After scene load
var loaded = function() {
    $('#submitbutton').click(function() {
        var user_text = editor.getValue() + "\n";
        $('#console').html('');
        try {
          SCENE.init();
          var parsed = PCG.parse(user_text);
          try {
              var result = evalStatements(parsed, defaultEnv());
              log_console(result);
          }
          catch(e) {
            var stack = e.stack.replace(/^[^\(]+?[\n$]/gm, '')
              .replace(/^\s+at\s+/gm, '')
              .replace(/^Object.<anonymous>\s*\(/gm, '{anonymous}()@')
              .split('\n');
              log_console(e + '\n' + 'Eval Error: ' + stack);
          }
        }
        catch(e) {
            var stack = e.stack.replace(/^[^\(]+?[\n$]/gm, '')
              .replace(/^\s+at\s+/gm, '')
              .replace(/^Object.<anonymous>\s*\(/gm, '{anonymous}()@')
              .split('\n');
            log_console(e + '\n' + 'Parse Error: ' + stack);
        }
    });
};

SCENE = new Scene(loaded);
</script>

</body>
</html>